import neovim

nvim-hs

stack必須。

plugin/internal.hs
wrapPlugin :: Applicative m => Plugin env -> m NeovimPlugin

main :: IO ()
main = neovim defaultConfig
    { plugins = plugins defaultConfig ++ [hogehoge.plugin]
    }

plugin :: Neovim (StartupConfig NeovimConfig) () NeovimPlugin
plugin = wrapPlugin Plugin
    { exports         = [ $(function' 'fibonacci) Sync ]
    , statefulExports = []
    }

fibonacci :: Int -> Neovim' String
fibonacci n = return . show $ fibs !! n
  where
    fibs :: [Integer]
    fibs = 0:1:scanl1 (+) fibs

nvim-hs/library/Neovim/Main.hs

nvim-hs/executable/Main.hs
module Main where

import           Neovim       (neovim, defaultConfig)

main :: IO ()
main = neovim defaultConfig

spec :: Spec
spec = parallel $ do
  let helloFile = "test-files/hello"
      withNeovimEmbedded f a = testWithEmbeddedNeovim f (Seconds 3) () a
  describe "Read hello test file" .
    it "should match 'Hello, World!'" . withNeovimEmbedded (Just helloFile) $ do
        bs <- vim_get_buffers
        l <- vim_get_current_line'
        liftIO $ l `shouldBe` "Hello, World!"
        liftIO $ length bs `shouldBe` 1
